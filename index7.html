<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prabu Gandhi Snacks & Sweets</title>

<style>
/* MODERN BACKGROUND & LAYOUT */
body {
    font-family: monospace;
    background:url("BG Img.png") no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}
/* CENTERED LOGIN/SIGNUP CARD */
#authContainer {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-grow: 1;
    padding: 20px;
}

.box {
    max-width: 420px;
    width: 100%;
    margin: auto;
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.hidden { display: none !important; }

h2 { text-align: center; margin: 10px 0; color: #333; }
.address { text-align: center; font-size: 11px; color: #666; }

.logo-title{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
}
.logo-title img{
    height:28px;
    width:auto;
}

input, button, select {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #ddd;
    box-sizing: border-box;
}

/* Password wrapper for professional eye icon */
.pass-wrapper { position: relative; }
.toggle-pass {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    display: flex;
    align-items: center;
    color: #666;
}
.toggle-pass svg { width: 20px; height: 20px; }

button {
    background: #2d3436;
    color: #fff;
    border: none;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
}

button:hover { background: #000; }

/* TABLE & BILLING STYLES */
table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }
th, td { text-align: center; padding: 6px; border-bottom: 1px solid #eee; }
th { border-bottom: 1px dashed #000; }
.total { text-align: right; font-size: 14px; margin-top: 10px; font-weight: bold; }
.remove { color: red; font-weight: bold; cursor: pointer; }

.btn-row { display: flex; justify-content: space-between; gap: 6px; }
.btn-center { display: flex; justify-content: center; margin: 6px 0; }
.btn-print { background: #0a7cff !important; }
.btn-danger { background: #b00020 !important; }
.btn-reset { background: #e67e22 !important; }

/* SAVED BILLS LIST */
.bill-card {
    border-bottom: 1px solid #eee;
    padding: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.bill-info { cursor: pointer; flex-grow: 1; }
.bill-del { color: #b00020; cursor: pointer; font-size: 18px; padding-left: 10px; }

.sales-table { width: 100%; margin-top: 10px; border: 1px solid #eee; }
.sales-table td { text-align: left; padding: 10px; border-bottom: 1px solid #f2f2f2; }
.sales-val { font-weight: bold; text-align: right; }

/* PRINT */
.print-only { display: none; }
@media print {
    body { background: #fff !important; }
    .box { display: none !important; }
    .print-only {
        display: block !important;
        width: 57mm;
        max-width: 57mm;
        padding: 2mm;
        margin: 0;
        font-size: 10.5px;
        line-height: 1.2;
    }
    hr { border-top: 1px dashed #000; }
    .row { display: flex; justify-content: space-between; font-size: 11px; }
    .head-row { display: flex; font-weight: bold; font-size: 11px; }
    .item-row { display: flex; font-size: 11px; }
    .c-sn { width: 8%; }
    .c-item { width: 42%; }
    .c-qty { width: 12%; text-align: right; }
    .c-rate { width: 18%; text-align: right; }
    .c-amt { width: 20%; text-align: right; }
}
</style>
</head>

<body>

<div id="authContainer">
    <div class="box" id="loginBox">
        <h2 id="loginTitle">Admin Login</h2>
        <input id="email" placeholder="Email">
        <div class="pass-wrapper">
            <input id="password" type="password" placeholder="Password">
            <span class="toggle-pass" onclick="togglePassword()">
                <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            </span>
        </div>
        <button onclick="login()">Login</button>
    </div>
</div>

<div class="box hidden" id="billBox" style="margin-top: 40px; margin-bottom: 40px;">
    <h2 class="logo-title">
        <img src="Logo.png" alt="Logo">
        Prabu Gandhi Snacks & Sweets
    </h2>
    <div class="address">
        2/253 Palladam Road, Puliampatti, Pollachi, Coimbatore - 642002<br>
        Ph: 8870567426
    </div>
    <select id="langSelect" onchange="setLang(this.value)">
        <option value="en">English</option>
        <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
    </select>

    <p><b id="billTxt">Bill No:</b> <span id="billNo">001</span></p>

    <input id="customer" placeholder="Customer Name">
    <input id="item" placeholder="Item">
    <input id="price" type="number" placeholder="Rate ‚Çπ">
    <button onclick="addItem()" id="addBtn">Add Item</button>

    <table>
        <thead>
            <tr>
                <th>S.No</th><th id="thItem">Item</th>
                <th id="thQty">Qty</th><th id="thRate">Rate</th>
                <th id="thAmt">Amt</th><th></th>
            </tr>
        </thead>
        <tbody id="list"></tbody>
    </table>

    <div class="total">
        <span id="itemLabel">Items</span> : <span id="itemCount">0</span><br>
        <span id="totalLabel">TOTAL</span> ‚Çπ <span id="total">0</span>
    </div>

    <div class="btn-row">
        <button onclick="saveBill()" id="saveBtn">Save</button>
        <button onclick="newBill()" id="newBtn">New Bill</button>
    </div>
    <div class="btn-row">
        <button class="btn-reset" onclick="resetAll()">Reset Counter</button>
        <button onclick="openSaved()" id="savedBtn">Saved Bills</button>
    </div>
    <div class="btn-row">
        <button onclick="showSales()" id="salesBtn">Sales</button>
        <button class="btn-print" onclick="preparePrint();window.print()">PRINT</button>
    </div>
    <div class="btn-center">
        <button class="btn-danger" onclick="logout()">Logout</button>
    </div>
</div>

<div class="box hidden" id="savedBox" style="margin-top: 40px;">
    <h2>Saved Bills</h2>
    <div id="savedList"></div>
    <button onclick="back()" style="margin-top: 10px;">Back</button>
</div>

<div class="box hidden" id="salesBox" style="margin-top: 40px;">
    <h2>Sales Summary</h2>
    <table class="sales-table">
        <tr><td>Today</td><td id="sToday" class="sales-val">‚Çπ0</td></tr>
        <tr><td>This Month</td><td id="sMonth" class="sales-val">‚Çπ0</td></tr>
        <tr><td>Jan - Jun (H1)</td><td id="sH1" class="sales-val">‚Çπ0</td></tr>
        <tr><td>Jul - Dec (H2)</td><td id="sH2" class="sales-val">‚Çπ0</td></tr>
    </table>
    <br>
    <button onclick="backFromSales()">Back</button>
</div>

<div id="printArea" class="print-only">
    <div style="text-align:center; font-weight:bold; font-size:14px;">Prabu Gandhi Snacks & Sweets</div>
    <div style="text-align:center; font-size:10px;">2/253 Palladam Road, Puliampatti | Ph: 8870567426</div>
    <hr>
    <div class="row"><span>Bill No: <span id="pBill"></span></span><span id="pDate"></span></div>
    <div class="row"><span>Name: <span id="pCustomer"></span></span><span id="pTime"></span></div>
    <hr>
    <div class="head-row">
        <span class="c-sn">#</span><span class="c-item">Item</span><span class="c-qty">Qty</span><span class="c-rate">Rate</span><span class="c-amt">Amt</span>
    </div>
    <hr>
    <div id="printItems"></div>
    <hr>
    <div style="text-align:right; font-weight:bold;">Total ‚Çπ <span id="pTotal"></span></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, orderBy, query, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDu5zwFFSrwPoAHulSebByz21PfigZEeNw",
  authDomain: "billing-software-c812e.firebaseapp.com",
  projectId: "billing-software-c812e",
  storageBucket: "billing-software-c812e.firebasestorage.app",
  messagingSenderId: "784499794212",
  appId: "1:784499794212:web:8f2afe45f634a6c26593b1"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let sum = 0;
let billDocs = [];
const t={
    en:{login:"Admin Login",add:"Add Item",save:"Save",new:"New Bill",saved:"Saved Bills",sales:"Sales",items:"Items",total:"TOTAL",bill:"Bill No:"},
    ta:{login:"‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï‡Æø ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà",add:"‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ≥‡Øç ‡Æö‡Øá‡Æ∞‡Øç",save:"‡Æö‡Øá‡ÆÆ‡Æø",new:"‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æ™‡Æø‡Æ≤‡Øç",saved:"‡Æö‡Øá‡ÆÆ‡Æø‡Æ§‡Øç‡Æ§ ‡Æ™‡Æø‡Æ≤‡Øç‡Æï‡Æ≥‡Øç",sales:"‡Æµ‡Æø‡Æ±‡Øç‡Æ™‡Æ©‡Øà",items:"‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øç",total:"‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç",bill:"‡Æ™‡Æø‡Æ≤‡Øç ‡Æé‡Æ£‡Øç:"}
};

/* PASSWORD TOGGLE LOGIC */
window.togglePassword = () => {
    const passInput = document.getElementById("password");
    const eyeIcon = document.getElementById("eyeIcon");
    
    if (passInput.type === "password") {
        passInput.type = "text";
        // Change to Eye-Off Icon
        eyeIcon.innerHTML = `<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>`;
    } else {
        passInput.type = "password";
        // Change back to Eye Icon
        eyeIcon.innerHTML = `<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>`;
    }
};

window.login = async () => {
    try {
        await signInWithEmailAndPassword(auth, email.value, password.value);
        authContainer.classList.add("hidden");
        billBox.classList.remove("hidden");
        updateBillNoDisplay();
    } catch(e) { alert("Invalid Credentials"); }
};

window.logout = async () => { await signOut(auth); location.reload(); };

/* LANGUAGE */
window.setLang = (l) => {
    localStorage.lang=l;
    const x=t[l];
    loginTitle.innerText=x.login; addBtn.innerText=x.add;
    saveBtn.innerText=x.save; newBtn.innerText=x.new;
    savedBtn.innerText=x.saved; salesBtn.innerText=x.sales;
    itemLabel.innerText=x.items; totalLabel.innerText=x.total; billTxt.innerText=x.bill;
};
setLang(localStorage.lang || "en");

/* BILLING LOGIC */
function updateBillNoDisplay() {
    let n = Number(localStorage.getItem("PG_BILL_COUNTER")) || 1;
    billNo.innerText = String(n).padStart(3, "0");
}

window.addItem = () => {
    let r = +price.value;
    if(!item.value || !r) return;
    let q = 1; sum += r;
    list.innerHTML += `<tr><td></td><td>${item.value}</td><td><button onclick="chgQty(this,-1)" style="width:25px; padding:2px;">-</button> <span>${q}</span> <button onclick="chgQty(this,1)" style="width:25px; padding:2px;">+</button></td><td>‚Çπ${r}</td><td>‚Çπ${r}</td><td class="remove" onclick="del(this)">‚ùå</td></tr>`;
    renumber(); total.innerText = sum; item.value = ""; price.value = "";
};

window.chgQty = (btn, delta) => {
    let row = btn.closest("tr");
    let span = row.querySelector("span");
    let qty = Number(span.innerText) + delta;
    if(qty < 1) return;
    let rate = Number(row.cells[3].innerText.replace("‚Çπ",""));
    let oldAmt = Number(row.cells[4].innerText.replace("‚Çπ",""));
    let newAmt = qty * rate;
    span.innerText = qty; row.cells[4].innerText = "‚Çπ" + newAmt;
    sum = sum - oldAmt + newAmt; total.innerText = sum;
};

window.del = (e) => {
    let r = e.closest("tr");
    sum -= +r.cells[4].innerText.replace("‚Çπ","");
    r.remove(); renumber(); total.innerText = sum;
};

function renumber(){
    [...list.rows].forEach((r,i)=>r.cells[0].innerText=i+1);
    itemCount.innerText = list.rows.length;
}

window.newBill = () => {
    let n = Number(localStorage.getItem("PG_BILL_COUNTER")) || 1;
    localStorage.setItem("PG_BILL_COUNTER", n + 1);
    updateBillNoDisplay();
    list.innerHTML = ""; sum = 0; total.innerText = 0; itemCount.innerText = 0; customer.value = "";
};

window.resetAll = () => {
    if(confirm("Reset counter to 001?")) { localStorage.setItem("PG_BILL_COUNTER", 1); updateBillNoDisplay(); }
};

/* FIREBASE SAVE, VIEW, DELETE */
window.saveBill = async () => {
    if (sum === 0) return alert("Add items first");
    let items = [];
    [...list.rows].forEach(r => { items.push({name: r.cells[1].innerText, qty: r.querySelector("span").innerText, rate: r.cells[3].innerText, amt: r.cells[4].innerText}); });
    try {
        await addDoc(collection(db, "bills"), { billNo: billNo.innerText, customer: customer.value || "Customer", total: sum, items: items, date: new Date().toISOString() });
        alert("Bill Saved!");
    } catch (e) { alert("Error saving"); }
};

window.openSaved = async () => {
    billBox.classList.add("hidden"); savedBox.classList.remove("hidden");
    savedList.innerHTML = "Loading...";
    const q = query(collection(db, "bills"), orderBy("date", "desc"));
    const snap = await getDocs(q);
    savedList.innerHTML = ""; billDocs = [];
    snap.forEach(d => {
        let b = d.data(); b.id = d.id; billDocs.push(b);
        let idx = billDocs.length - 1;
        savedList.innerHTML += `<div class="bill-card"><div class="bill-info" onclick="loadBill(${idx})"><b>${b.billNo}</b> | ${b.customer} | ‚Çπ${b.total}</div><div class="bill-del" onclick="deleteBill('${b.id}')">üóëÔ∏è</div></div>`;
    });
};

window.deleteBill = async (id) => {
    if(confirm("Delete this bill permanently?")) {
        try { await deleteDoc(doc(db, "bills", id)); openSaved(); } catch(e) { alert("Error deleting"); }
    }
};

window.loadBill = (i) => {
    let b = billDocs[i]; billNo.innerText = b.billNo; customer.value = b.customer; list.innerHTML = "";
    b.items.forEach((item, idx) => {
        list.innerHTML += `<tr><td>${idx+1}</td><td>${item.name}</td><td><span>${item.qty}</span></td><td>${item.rate}</td><td>${item.amt}</td><td class="remove" onclick="del(this)">‚ùå</td></tr>`;
    });
    sum = b.total; total.innerText = sum; renumber(); back();
};

window.back = () => { savedBox.classList.add("hidden"); billBox.classList.remove("hidden"); };

window.showSales = async () => {
    billBox.classList.add("hidden"); salesBox.classList.remove("hidden");
    let t1=0, t2=0, h1=0, h2=0; let today = new Date().toISOString().slice(0, 10); let month = today.slice(0, 7);
    const snap = await getDocs(collection(db, "bills"));
    snap.forEach(d => {
        let b = d.data(); let dstr = b.date.slice(0, 10); let mstr = b.date.slice(0, 7); let mo = new Date(b.date).getMonth();
        if (dstr === today) t1 += b.total; if (mstr === month) t2 += b.total; mo < 6 ? h1 += b.total : h2 += b.total;
    });
    sToday.innerText = "‚Çπ" + t1; sMonth.innerText = "‚Çπ" + t2; sH1.innerText = "‚Çπ" + h1; sH2.innerText = "‚Çπ" + h2;
};

window.backFromSales = () => { salesBox.classList.add("hidden"); billBox.classList.remove("hidden"); };

window.preparePrint = () => {
    pBill.innerText = billNo.innerText; pDate.innerText = new Date().toLocaleDateString(); pTime.innerText = new Date().toLocaleTimeString(); pCustomer.innerText = customer.value || "Customer"; pTotal.innerText = sum;
    let h = "";
    [...list.rows].forEach(r => { h += `<div class="item-row"><span class="c-sn">${r.cells[0].innerText}</span><span class="c-item">${r.cells[1].innerText}</span><span class="c-qty">${r.querySelector("span").innerText}</span><span class="c-rate">${r.cells[3].innerText}</span><span class="c-amt">${r.cells[4].innerText}</span></div>`; });
    printItems.innerHTML = h;
};
</script>

</body>
</html>